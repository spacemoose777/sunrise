<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="theme-color" content="#0f1117" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Sunrise" />
  <meta name="description" content="Your daily journal and mood companion." />
  <title>Sunrise</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192.png" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />
</head>
<body class="auth-locked">

  <!-- ‚îÄ‚îÄ‚îÄ AUTH SCREEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="auth-screen" class="auth-screen">
    <div class="auth-card">
      <div class="auth-icon">‚òÄÔ∏è</div>
      <h1 class="auth-title">Sunrise</h1>
      <p class="auth-subtitle" id="auth-subtitle">Sign in to your journal</p>
      <form id="auth-form" novalidate>
        <div id="auth-email-group" class="auth-field-group">
          <input type="email" id="auth-email" class="field" placeholder="Email" autocomplete="email" required />
        </div>
        <input type="password" id="auth-password" class="field" placeholder="Password" autocomplete="current-password" required />
        <button type="submit" class="btn-save auth-btn" id="auth-submit-btn">Sign In</button>
        <p class="auth-error" id="auth-error"></p>
      </form>
      <p class="auth-footer">Your journal is end-to-end encrypted</p>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ MIGRATION PROMPT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="migration-prompt" class="modal" style="display:none">
    <div class="modal-backdrop"></div>
    <div class="modal-sheet">
      <div class="modal-content" style="text-align:center; padding: 32px 20px;">
        <h2 class="section-title" style="justify-content:center;">Import Local Entries?</h2>
        <p id="migration-count" class="section-hint" style="margin:16px 0;"></p>
        <p class="section-hint">They will be encrypted and synced to your cloud journal.</p>
        <div style="display:flex; gap:10px; justify-content:center; margin-top:20px;">
          <button class="btn-secondary" id="migration-skip">Skip</button>
          <button class="btn-save" id="migration-import" style="max-width:180px;">Import</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ NAV ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <nav class="bottom-nav">
    <button class="nav-btn active" data-view="today" aria-label="Today">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
      <span>Today</span>
    </button>
    <button class="nav-btn" data-view="history" aria-label="History">
      <svg viewBox="0 0 24 24"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
      <span>History</span>
    </button>
    <button class="nav-btn" data-view="settings" aria-label="Settings">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
      <span>Settings</span>
    </button>
  </nav>

  <!-- ‚îÄ‚îÄ‚îÄ TODAY VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <main id="view-today" class="view active">

    <header class="page-header">
      <div class="date-display" id="today-date"></div>
      <h1 class="app-title">Sunrise</h1>
      <p class="greeting" id="greeting"></p>
    </header>

    <!-- Install Banner (shown when PWA install is available) -->
    <div id="install-banner" class="install-banner" style="display:none">
      <span class="install-banner-text">‚òÄÔ∏è Install Sunrise on your home screen</span>
      <div class="install-banner-btns">
        <button class="btn-save" id="install-banner-btn">Install</button>
        <button class="install-banner-dismiss" id="install-banner-dismiss" aria-label="Dismiss">‚úï</button>
      </div>
    </div>

    <!-- Today's entry count -->
    <p class="today-entry-count" id="today-entry-count" style="display:none"></p>

    <!-- Quote of the Day -->
    <section class="card quote-card">
      <div class="quote-mark">"</div>
      <p id="daily-quote" class="quote-text"></p>
      <p id="quote-author" class="quote-author"></p>
    </section>

    <!-- Journal Form ‚Äî sections are rendered dynamically from the field schema -->
    <form id="journal-form" novalidate>

      <div id="journal-fields"></div>

      <div class="submit-area">
        <button type="submit" class="btn-save" id="save-btn">Save Entry</button>
        <p class="save-status" id="save-status"></p>
        <div class="print-action-row">
          <button type="button" class="btn-secondary print-btn" id="print-blank-btn">üñ® Blank Template</button>
          <button type="button" class="btn-secondary print-btn" id="print-filled-btn">üñ® Today's Entry</button>
        </div>
      </div>

    </form>

  </main>

  <!-- ‚îÄ‚îÄ‚îÄ HISTORY VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <main id="view-history" class="view">

    <header class="page-header">
      <h1 class="app-title">History</h1>
    </header>

    <div id="history-empty" class="empty-state" style="display:none">
      <p>No entries yet. Start with today! ‚òÄÔ∏è</p>
    </div>

    <div id="history-list" class="history-list"></div>

  </main>

  <!-- ‚îÄ‚îÄ‚îÄ SETTINGS VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <main id="view-settings" class="view">

    <header class="page-header">
      <h1 class="app-title">Settings</h1>
    </header>

    <section class="card">
      <h2 class="section-title">Personal</h2>
      <p class="section-hint">Add your name to personalise the greeting in your journal.</p>
      <input type="text" id="user-name-input" class="field" placeholder="Your first name‚Ä¶" autocomplete="given-name" style="margin-top:12px;" />
      <p class="save-status" id="name-status" style="margin-top:8px;"></p>
    </section>

    <section class="card">
      <h2 class="section-title">Journal Fields</h2>
      <p class="section-hint">Customise the fields in your journal ‚Äî add, edit, remove or reorder them.</p>
      <div id="field-schema-list"></div>
      <button type="button" class="btn-secondary" id="add-field-btn" style="margin-top:12px; width:100%;">+ Add Field</button>
    </section>

    <section class="card">
      <h2 class="section-title">Timezone</h2>
      <p class="section-hint">Set your timezone so entries are grouped by your local date.</p>
      <select class="field tz-select" id="tz-select">
        <option value="Pacific/Auckland">Pacific/Auckland (NZST/NZDT)</option>
        <option value="Pacific/Chatham">Pacific/Chatham</option>
        <option value="Pacific/Fiji">Pacific/Fiji</option>
        <option value="Asia/Tokyo">Asia/Tokyo (JST)</option>
        <option value="Asia/Seoul">Asia/Seoul (KST)</option>
        <option value="Asia/Shanghai">Asia/Shanghai (CST)</option>
        <option value="Asia/Hong_Kong">Asia/Hong Kong (HKT)</option>
        <option value="Asia/Singapore">Asia/Singapore (SGT)</option>
        <option value="Asia/Kolkata">Asia/Kolkata (IST)</option>
        <option value="Asia/Dubai">Asia/Dubai (GST)</option>
        <option value="Europe/Moscow">Europe/Moscow (MSK)</option>
        <option value="Europe/Istanbul">Europe/Istanbul (TRT)</option>
        <option value="Europe/Athens">Europe/Athens (EET)</option>
        <option value="Europe/Berlin">Europe/Berlin (CET)</option>
        <option value="Europe/Paris">Europe/Paris (CET)</option>
        <option value="Europe/London">Europe/London (GMT/BST)</option>
        <option value="Atlantic/Reykjavik">Atlantic/Reykjavik (GMT)</option>
        <option value="America/Sao_Paulo">America/Sao Paulo (BRT)</option>
        <option value="America/New_York">America/New York (EST/EDT)</option>
        <option value="America/Chicago">America/Chicago (CST/CDT)</option>
        <option value="America/Denver">America/Denver (MST/MDT)</option>
        <option value="America/Los_Angeles">America/Los Angeles (PST/PDT)</option>
        <option value="America/Anchorage">America/Anchorage (AKST/AKDT)</option>
        <option value="Pacific/Honolulu">Pacific/Honolulu (HST)</option>
        <option value="Australia/Sydney">Australia/Sydney (AEST/AEDT)</option>
        <option value="Australia/Adelaide">Australia/Adelaide (ACST/ACDT)</option>
        <option value="Australia/Perth">Australia/Perth (AWST)</option>
      </select>
      <p class="tz-status save-status" id="tz-status"></p>
    </section>

    <section class="card">
      <h2 class="section-title">Daily Questions</h2>
      <p class="section-hint">A thought-provoking question appears each day. Add your own to the rotation.</p>
      <div id="custom-questions-list" class="custom-questions-list"></div>
      <div class="question-add-row">
        <textarea class="field field-wrap" id="new-question-input" placeholder="Add your own question to the rotation‚Ä¶" rows="1" autocomplete="off"></textarea>
        <button type="button" class="btn-secondary" id="add-question-btn">Add</button>
      </div>
    </section>

    <section class="card">
      <h2 class="section-title">Morning Reminder</h2>
      <p class="section-hint">Enable a daily notification at 7:00 am to prompt your journal.</p>
      <div class="setting-row">
        <label class="toggle-label" for="notif-toggle">Daily 7am notification</label>
        <label class="toggle-switch">
          <input type="checkbox" id="notif-toggle" />
          <span class="toggle-slider"></span>
        </label>
      </div>
      <p class="notif-status" id="notif-status"></p>
    </section>

    <section class="card">
      <h2 class="section-title">Data</h2>
      <p class="section-hint">Your journal is end-to-end encrypted and synced to the cloud.</p>
      <div class="data-actions">
        <button class="btn-secondary" id="export-btn">Export as JSON</button>
        <button class="btn-danger" id="clear-btn">Clear All Data</button>
      </div>
    </section>

    <section class="card">
      <h2 class="section-title">Account</h2>
      <p class="section-hint" id="account-email"></p>
      <div class="data-actions">
        <button class="btn-secondary" id="logout-btn">Sign Out</button>
      </div>
    </section>

    <section class="card">
      <h2 class="section-title">Install App</h2>
      <p class="section-hint">Add Sunrise to your home screen for the best experience.</p>
      <button class="btn-secondary" id="install-btn" style="display:none">Add to Home Screen</button>
      <p class="install-hint" id="install-hint">
        <strong>iPhone/iPad:</strong> Open in Safari, tap the Share button (‚Üë) and choose <strong>Add to Home Screen</strong>.<br><br>
        <strong>Android:</strong> Open in Chrome, tap the menu (‚ãÆ) and choose <strong>Add to Home screen</strong>.
      </p>
    </section>

    <section class="card about-card">
      <p class="about-text">Sunrise ¬∑ Your daily companion<br/>End-to-end encrypted. Only you can read your journal.</p>
    </section>

  </main>

  <!-- ‚îÄ‚îÄ‚îÄ ENTRY DETAIL MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="entry-modal" class="modal" role="dialog" aria-modal="true" aria-label="Journal entry" style="display:none">
    <div class="modal-backdrop"></div>
    <div class="modal-sheet">
      <button class="modal-close" id="modal-close" aria-label="Close">‚úï</button>
      <div id="modal-content" class="modal-content"></div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ FIELD EDITOR MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="field-editor-modal" class="modal" role="dialog" aria-modal="true" aria-label="Edit field" style="display:none">
    <div class="modal-backdrop" id="field-editor-backdrop"></div>
    <div class="modal-sheet">
      <button class="modal-close" id="field-editor-close" aria-label="Close">‚úï</button>
      <div class="modal-content" style="padding-top:8px;">
        <h2 class="section-title" id="field-editor-title" style="margin-bottom:20px;">Add Field</h2>

        <div class="field-editor-row">
          <div class="field-editor-icon-wrap">
            <label class="section-hint" style="margin-bottom:6px; display:block;">Icon</label>
            <input type="text" id="field-editor-icon" class="field field-editor-icon-input" maxlength="4" />
          </div>
          <div style="flex:1; min-width:0;">
            <label class="section-hint" style="margin-bottom:6px; display:block;">Label</label>
            <input type="text" id="field-editor-label" class="field" placeholder="Field name‚Ä¶" />
          </div>
        </div>
        <p id="field-editor-suggestion" class="field-editor-suggestion"></p>

        <label class="section-hint" style="margin-bottom:6px; display:block; margin-top:16px;">Type</label>
        <select id="field-editor-type" class="field" style="cursor:pointer; margin-bottom:16px;">
          <option value="text">Single answer</option>
          <option value="list">3-item list (e.g. Gratitude)</option>
          <option value="textarea">Long text (free write)</option>
        </select>

        <label class="section-hint" style="margin-bottom:6px; display:block;">Subtitle <span style="color:var(--text-hint)">(optional)</span></label>
        <input type="text" id="field-editor-hint" class="field" placeholder="Short description under the title‚Ä¶" />

        <button type="button" class="btn-save" id="field-editor-save" style="margin-top:24px;">Save Field</button>
      </div>
    </div>
  </div>

  <!-- ‚îÄ‚îÄ‚îÄ PRINT VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="print-view" aria-hidden="true"></div>

  <script src="supabase.min.js"></script>
  <script src="quotes.js"></script>
  <script src="questions.js"></script>
  <script src="crypto.js"></script>
  <script src="supabase-client.js"></script>
  <script src="app.js"></script>
</body>
</html>
